# guide.md — Official sources & snippets for the vector DB stack

A quick map to the **official docs/downloads** for the five backends (**Milvus**, **Elasticsearch**, **Chroma**, **Qdrant**, **Weaviate**), plus exact commands and compose snippets. Chroma is standardized here to **port 8000**.

---

## Milvus (Standalone)

- **Docs (official):** https://milvus.io/docs/install_standalone-docker-compose.md
- **Release compose (v2.6.2):** https://github.com/milvus-io/milvus/releases/download/v2.6.2/milvus-standalone-docker-compose.yml

**Pull via CLI**

```bash
# Linux/macOS
wget https://github.com/milvus-io/milvus/releases/download/v2.6.2/milvus-standalone-docker-compose.yml -O docker-compose.yml
docker compose up -d
````

```powershell
# Windows PowerShell
Invoke-WebRequest `
  -Uri https://github.com/milvus-io/milvus/releases/download/v2.6.2/milvus-standalone-docker-compose.yml `
  -OutFile docker-compose.yml
docker compose up -d
```

**Notes**

* Image tag uses a leading `v` (e.g., `milvusdb/milvus:v2.6.2`).
* Health: container HTTP `http://localhost:9091/healthz`; gRPC on `19530`.

---

## Elasticsearch (Single-node dev)

* **Docs (official):** [https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html](https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html)
* **Image:** `docker.elastic.co/elasticsearch/elasticsearch:<version>` (e.g., `8.13.4`)

**Minimal single-node compose (dev)**

```yaml
services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.13.4
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false   # dev only
      - ES_JAVA_OPTS=-Xms1g -Xmx1g
    ports:
      - "9200:9200"
```

**Health:** `curl http://localhost:9200` (JSON cluster info).

---

## Chroma (Server mode @ 8000)

* **Docs (official):** [https://docs.trychroma.com/](https://docs.trychroma.com/)
* **Image:** `ghcr.io/chroma-core/chroma:<tag>` (pin a tag for stability, e.g., `0.5.5`)

**Standard compose (host 8000 → container 8000)**

```yaml
services:
  chroma:
    image: ghcr.io/chroma-core/chroma:0.5.5
    environment:
      - CHROMA_SERVER_HOST=0.0.0.0
      - CHROMA_SERVER_HTTP_PORT=8000
      - ANONYMIZED_TELEMETRY=False
    ports:
      - "8000:8000"
    volumes:
      - chroma-data:/data   # image’s default persist path is /data
```

**Health:** `GET http://localhost:8000/api/v2/heartbeat`

---

## Qdrant

* **Docs (official):** [https://qdrant.tech/documentation/](https://qdrant.tech/documentation/)
* **Image:** `qdrant/qdrant:latest` (or pin a version)

**Minimal compose**

```yaml
services:
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"   # HTTP
      - "6334:6334"   # gRPC
    environment:
      # Optional auth for dev -> set an API key
      # QDRANT__SERVICE__API_KEY: "change-me"
      QDRANT__SERVICE__GRPC_PORT: 6334
      QDRANT__STORAGE__STORAGE_PATH: "/qdrant/storage"
      QDRANT__STORAGE__SNAPSHOTS_PATH: "/qdrant/snapshots"
    volumes:
      - qdrant-storage:/qdrant/storage
      - qdrant-snapshots:/qdrant/snapshots
```

**Health:** `GET http://localhost:6333/readyz` (readiness).
(Other endpoints: `/livez`, `/healthz`.)

---

## Weaviate

* **Docs (official):** [https://weaviate.io/developers/weaviate](https://weaviate.io/developers/weaviate)
* **Image:** `semitechnologies/weaviate:latest` (or pin a version)

**Bring-your-own-embeddings compose (simplest)**

```yaml
services:
  weaviate:
    image: semitechnologies/weaviate:latest
    environment:
      QUERY_DEFAULTS_LIMIT: "25"
      AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: "true"   # set false + OIDC for prod
      PERSISTENCE_DATA_PATH: "/var/lib/weaviate"
      DEFAULT_VECTORIZER_MODULE: "none"
      ENABLE_MODULES: ""
      CLUSTER_HOSTNAME: "node1"
    ports:
      - "8080:8080"   # REST/GraphQL
      - "50051:50051" # gRPC (if supported by image)
    volumes:
      - weaviate-data:/var/lib/weaviate
```

**Health:** `GET http://localhost:8080/v1/.well-known/ready` and `GET /v1/meta`.

---

## Using them together

If you want **one file** that brings up all five:

* Start from `tests/cpu/docker-compose.yml` (combined stack using Milvus’s `etcd` + `minio` + `standalone`) and add the Chroma, Elasticsearch, Qdrant, and Weaviate services as above.
* Keep ports aligned with your app’s env:

```bash
export VECTOR_DB=chroma   # or: elastic | milvus | qdrant | weaviate | faiss
export CHROMA_PORT=8000
export ES_URL=http://127.0.0.1:9200
export MILVUS_PORT=19530
export QDRANT_URL=http://127.0.0.1:6333
export WEAVIATE_URL=http://127.0.0.1:8080
```

---

## Manual health checks

```bash
# Chroma (v2)
curl -fsS http://127.0.0.1:8000/api/v2/heartbeat

# Elasticsearch
curl -fsS http://127.0.0.1:9200 | jq .

# Milvus (Python)
python - <<'PY'
from pymilvus import connections
connections.connect(host="127.0.0.1", port="19530")
print("Milvus OK")
PY

# Qdrant
curl -fsS http://127.0.0.1:6333/readyz | jq .

# Weaviate
curl -fsS http://127.0.0.1:8080/v1/.well-known/ready
curl -fsS http://127.0.0.1:8080/v1/meta | jq .
```

---

## Troubleshooting

* **Containers won’t start / exit immediately**
  `docker compose logs --no-color` to inspect; ensure ports aren’t in use.
* **Elasticsearch fails to start**
  Increase Docker memory or reduce JVM heap (`ES_JAVA_OPTS=-Xms512m -Xmx512m`).
* **Milvus health check fails**
  Ensure your `.venv` has `pymilvus`; re-run the helper script.
* **Chroma heartbeat not responding**
  `docker logs chroma` and verify nothing else is on `:8000`.
* **Qdrant not ready**
  Use `/readyz` (not `/heartbeat`); check `docker logs qdrant`.
* **Weaviate not ready**
  Check `/v1/.well-known/ready` and `docker logs weaviate`.
* **Port already in use**
  Another service is bound to `8000/9200/19530/6333/8080`. Stop it or change mapped ports in compose.

---